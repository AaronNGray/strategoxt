module properties/tasks

imports 
	
	nabl/-
  properties/-
  task/core
  
signature
  
  constructors

    PropLookup : Property * Term                   -> Instruction    
    PropCalc   : Term * Term                       -> Instruction
    PropCalc   : Term                              -> Instruction
    PropCheck  : Property * Relation * Term * Term -> Instruction

rules
  
  perform-task(|n): 
  	PropLookup(kind, t) -> result
  	where
  		resolved := <nabl-collect-one-resolved-def> t;
  		switch id
  			case ?Def(_) : where(nabl-uri; nabl-add-read(|n)); nabl-get-property(|kind); insert-results-or-create-dependency // TODO: is this read needed?
  			otherwise    : id
  		end => result
  
  avoid-task(|dep*):
    PropCalc(_) -> <perform-task(|0)> 
    where
      [] := dep*
  	
  perform-task(|n): 
  	PropCalc(result) -> result
  
  avoid-task(|dep*):
    PropCheck(kind, rel, actual, expected) -> <perform-task(|0) <+ ![]> 
    where
      [] := dep*
  	
  perform-task(|n): 
  	PropCheck(kind, rel, actual, expected) -> actual
  	where
  		<property-eq> (kind, rel, actual, expected)
