Specification([Imports(["options","pack-graph","dynamic-rules","config","verbose"]),Signature([Constructors([OpDecl("Include",FunType([ConstType(Var("File"))],ConstType(Var("Include")))),OpDecl("Prefix",FunType([ConstType(Var("String"))],ConstType(Var("Option")))),OpDecl("Ignore",ConstType(Var("Option")))])]),Strategies([SDef("pack-module-options",[],Call(SVar("parse-options"),[Choice(Call(SVar("io-options"),[]),Call(SVar("pack-options"),[]))])),SDef("pack-options",[],Choice(Call(SVar("ArgOption"),[Choice(Match(Str("-I")),Match(Str("--Include"))),Seq(Where(BA(Call(SVar("extend-config"),[]),Op("",[Str("-I"),Op("Cons",[Str("-I"),Op("Cons",[RootApp(Id),Op("Nil",[])])])]))),Build(Op("Include",[RootApp(Id)]))),Build(Str("-I d|--Include d   Include modules from directory d"))]),Choice(Call(SVar("Option"),[Match(Str("-nodep")),Seq(Where(BA(Call(SVar("set-config"),[]),Op("",[Str("-nodep"),Str("")]))),Build(Var("NoDependency"))),Build(Str("-nodep"))]),Choice(Call(SVar("ArgOption"),[Match(Str("-dep")),Seq(Where(BA(Call(SVar("set-config"),[]),Op("",[Str("-dep"),RootApp(Id)]))),LRule(Rule(Var("x"),Op("Dependency",[Var("x")]),Id))),Build(Str("-dep f             write dependency to file f"))]),Call(SVar("ArgOption"),[Match(Str("--prefix")),Seq(Where(BA(Call(SVar("set-config"),[]),Op("",[Str("--prefix"),RootApp(Id)]))),LRule(Rule(Var("x"),Op("Prefix",[Var("x")]),DynamicRules([RDef("Prefix",[],Rule(Op("",[]),Var("x"),Id))])))),Build(Str("--prefix"))]))))),SDef("pack-modules",[VarDec("pack",FunType([ConstType(Var("term")),FunType([ConstType(Var("term"))],ConstType(Var("term")))],ConstType(Var("term"))))],LChoice(Call(SVar("pack-modules"),[Call(SVar("pack"),[]),Fail]),BA(Call(SVar("fatal-error"),[]),Op("Cons",[Str("Packing modules failed"),Op("Nil",[])])))),SDef("pack-modules",[VarDec("pack",FunType([ConstType(Var("term")),FunType([ConstType(Var("term"))],ConstType(Var("term")))],ConstType(Var("term")))),DefaultVarDec("dep-base")],Seq(AM(Call(SVar("pack-module-options"),[]),Var("options")),Seq(Call(SVar("try"),[Call(SVar("need-help"),[Call(SVar("pack-modules-usage"),[])])]),Seq(Call(SVar("list"),[Call(SVar("try"),[Choice(Match(Op("Program",[Var("prog")])),Choice(Match(Op("Input",[Var("in")])),Choice(Match(Op("Output",[Var("out")])),Match(Op("Dependency",[Var("dep")])))))])]),Seq(AM(Call(SVar("filter"),[LRule(Rule(Op("Include",[Var("p")]),Var("p"),Id))]),Var("path")),Seq(AM(LChoice(Build(Var("in")),Build(Var("stdin"))),Var("infile")),Seq(AM(LChoice(Build(Var("out")),Build(Var("stdout"))),Var("outfile")),Seq(AM(BA(Call(SVar("pack"),[Build(Var("path"))]),Var("infile")),Op("",[Var("files"),Var("spec")])),Seq(Build(Var("options")),Seq(LChoice(Seq(Call(SVar("option-defined"),[Match(Var("Binary"))]),BA(Call(SVar("WriteToBinaryFile"),[]),Op("",[Var("outfile"),Var("spec")]))),BA(Call(SVar("WriteToTextFile"),[]),Op("",[Var("outfile"),Var("spec")]))),Seq(Call(SVar("try"),[Seq(AM(LChoice(Build(Var("dep")),Seq(Not(BA(Call(SVar("option-defined"),[Match(Op("NoDependency",[]))]),Var("options"))),Call(SVar("dep-base"),[]))),Var("depfile")),BA(Call(SVar("create-dep-file"),[Build(Var("depfile"))]),Op("",[Var("outfile"),Var("files")])))]),Seq(Call(SVar("if-verbose1"),[BA(Call(SVar("printnl"),[]),Op("",[Var("stderr"),Op("Cons",[Var("prog"),Op("Cons",[Str(" ("),Op("Cons",[RootApp(Call(SVar("run-time"),[])),Op("Cons",[Str(" secs)"),Op("Nil",[])])])])])]))]),BA(Call(SVar("exit"),[]),Int(0)))))))))))))),SDef("pack-modules-usage",[],Seq(Call(SVar("option-defined"),[Match(Op("Program",[Var("prog")]))]),Seq(BA(Call(SVar("printnl"),[]),Op("",[Var("stderr"),Op("Cons",[Str("usage : "),Op("Cons",[Var("prog"),Op("Cons",[Str(" [-S] [-I dir] [-i file]"),Op("Cons",[Str(" [-o file] [-b] [-s] [--help|-h|-?]"),Op("Cons",[Str(" [-dep target | -nodep]"),Op("Nil",[])])])])])])])),BA(Call(SVar("exit"),[]),Int(1)))))]),Rules([RDef("create-dep-file",[DefaultVarDec("dep-base")],Rule(Op("",[Var("outfile"),Var("files")]),Op("",[Var("outfile"),Var("files")]),Seq(AM(BA(Call(SVar("dep-base"),[]),Var("outfile")),Var("out")),Seq(AM(BA(Call(SVar("open-file"),[]),Op("",[App(Call(SVar("add-extension"),[]),Op("",[Var("out"),Str("dep")])),Str("w")])),Var("dep")),Seq(BA(Call(SVar("printnl"),[]),Op("",[Var("dep"),Op("Cons",[Var("out"),App(Call(SVar("separate-by"),[Build(Str(" \\\n\t"))]),Op("Cons",[Str(" :"),Var("files")]))])])),BA(Call(SVar("close-file"),[]),Var("dep")))))))]),Signature([Constructors([OpDecl("NoDependency",ConstType(Var("Option"))),OpDecl("Dependency",FunType([ConstType(Var("String"))],ConstType(Var("Option"))))])])])