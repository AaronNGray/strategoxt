module lift-dynamic-rules-test
imports sunit lift-dynamic-rules
strategies

  lift-dynamic-rules-test =
    test-suite(!"lift-dynamic-rules-test",
      test1;
      test2;
      test3
    )

  test1 =
    apply-test(!"test1"
	, Strategies(lift-dynamic-rule)
	, !|[ strategies
		BindConstant() =
                  ?Assign(Var(X), E)
                  ; rules( ConstProp() : Var(X) -> E where id )
           ]|
	)

  test2 =
    apply-test(!"test2"
	, where(!["X", "E"])
	  ; SplitDynamicRule(!|[ assert(!~str:<id>) ]|)
	, !|[ ConstProp() : Var(X) -> E where id ]|
	)

  test3 =
    apply-test(!"test3"
	, Strategies(lift-dynamic-rule)
	, !|[ strategies
		BindConstant() =
                  ?fdec@FunDec(F, _, _)
                  ; rules( Inline() : Call(F, ES) -> E 
				      where <rename()> fdec => FunDec(F, XS, E) )
           ]|
	)
