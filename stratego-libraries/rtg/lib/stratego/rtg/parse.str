module stratego/rtg/parse
imports
  libstratego-sglr

strategies

  /**
   * Parse an RTG from a file.
   *
   * @type String -> RTG
   */
  parse-rtg-file =
    where(
      STRRTG-get-rtg-parsetable
      ; tbl := <open-parse-table>
    )
    ; finally(parse-file(|tbl), <close-parse-table> tbl)
    ; rtg-parsefix

  external STRRTG-get-rtg-parsetable(|)


strategies

  /**
   * @type  RTG -> RTG
   */
  rtg-parsefix =
    topdown(try(rtg-ParseFix))

  rtg-ParseFix :
    Plain(s) -> s

  rtg-ParseFix :
    Quoted(parts) ->
      < map(?Chars(<id>) + ?EscapeSeq(<<implode-string> [<id>]>))
      ; concat-strings
      > parts

  rtg-ParseFix =
    TupleTerm(string-to-int)
