/**
 * This module provides a basic strategy for specifying
 * run-time verified strategies.
 *
 * @author Lennart Kats <lennart add lclnet.nl>
 * 
 */
module lang/with

imports
  util/log
  strategy/conditional

strategies

  /**
   * Evaluate a strategy s, or, on failure, end with a fatal error.
   *
   * This strategy is used internally by the with(s) strategy, which
   * fails with a message reporting the name of the current strategy/rule.
   *
   * @note In future revisions, a facility may be provided to "catch"
   *       failures caused by with clauses and this strategy.
   */
  with(s|message) =
    where(s)
    <+ log(|Critical(), message, <id>)
     ; prim("SSL_stacktrace_get_all_frame_names")
     ; try(?["with_1_1" | <id>])
     ; report-failure

