module compile-match
imports match-to-matrix matrix-to-dfa opt-lib
strategies

  compile-match-io = 
    io-wrap(apply-to-bodies(topdown(try(ExpandId)); match-to-dfa))

  match-to-dfa = 
    match-to-matrix    
    ; matrix-to-dfa
    ; strename

  ExpandId :
    Id -> Scope([x], Seq(Match(Var(x)), Build(Var(x))))
    where new => x
