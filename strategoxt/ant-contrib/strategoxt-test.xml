<?xml version="1.0"?>
<project name="org.strategoxt.ant.test" basedir=".">
	<macrodef name="strj-test">
		<attribute name="input" />
		<sequential>
			<log message="Testing @{input}" />
			<dirname file="@{input}" property="@{input}.dirname" />
			<basename file="@{input}" property="@{input}.basename" suffix=".str" />
			<mkdir dir="${@{input}.dirname}/${@{input}.basename}/test" />
			<strj-for-test input="@{input}" output="${@{input}.dirname}/${@{input}.basename}/test/Main.java" package="test">
				<strjargs>
					<arg value="-m" />
					<arg value="main-${@{input}.basename}" />
					<arg value="-la" />
					<arg value="stratego-lib" />
					<arg value="-la" />
					<arg value="stratego-gpp" />
					<arg value="-la" />
					<arg value="stratego-xtc" />
					<arg value="-la" />
					<arg value="stratego-aterm" />
					<arg value="-la" />
					<arg value="stratego-rtg" />
					<arg value="-la" />
					<arg value="stratego-sglr" />
					<arg value="-la" />
					<arg value="java-front" />
					<arg value="-I" />
					<arg value="${syntaxaterm}" />
					<arg value="-I" />
					<arg value="${syntaxbox}" />
					<arg value="-I" />
					<arg value="generated/" />
					<arg value="-I" />
					<arg value="${@{input}.dirname}" />
				</strjargs>
				<str-deps>
					<srcfiles dir="." includes="*.jar" />
				</str-deps>
			</strj-for-test>
			<javac srcdir="${@{input}.dirname}/${@{input}.basename}" destdir="${@{input}.dirname}/${@{input}.basename}" classpath="./strategoxt.jar" source="1.5" target="1.5" nowarn="on" fork="true" debug="true" debuglevel="source" compiler="classic">
			</javac>
			<java fork="true" classname="test.Main" failonerror="true" dir="${@{input}.dirname}">
				<classpath>
					<pathelement location="./strategoxt.jar" />
					<pathelement path="${@{input}.dirname}/${@{input}.basename}" />
				</classpath>
			</java>
		</sequential>
	</macrodef>
</project>