#! /bin/sh


if [ -f /etc/gentoo-release ] ; then 
	# Environment variables for our Gentoo friends.
	export WANT_AUTOMAKE="1.8"
	export WANT_AUTOCONF="2.59"
#elif [ -f /etc/debian_version ] ; then
#	# Environment variables for our Debian friends.
#        export ACLOCAL=/usr/bin/aclocal-1.8
#        export AUTOMAKE=/usr/bin/automake-1.8
fi

# Determine autoxt to use.
if test -z "$STRATEGOXT_BASELINE"; then
  echo "***********************************************************"
  echo "                          WARNING"
  echo ""
  echo "The environment variable STRATEGOXT_BASELINE is not set."
  echo "It is recommended to set this variable to make sure that"
  echo "the right autoxt is used for bootstrapping Stratego/XT. I"
  echo "assume that the baseline you want to use is on the path."
  echo "***********************************************************"
  AUTOXT="autoxt"
else
  test -x "$STRATEGOXT_BASELINE/bin/autoxt"
  if test $? -eq 0; then
    AUTOXT="$STRATEGOXT_BASELINE/bin/autoxt"
  else
    echo "error: $STRATEGOXT_BASELINE/bin/autoxt does not exist."
    echo "Please check your STRATEGOXT_BASELINE environment variable"
    exit 1
  fi
fi

# echo "bootstrap: using autoxt at $AUTOXT"

# Apply the autotools
# $AUTOXT || exit 1
# mv ./autoxt.m4 ./config/  || exit 1

echo "WARNING: hack: using our own Makefile.xt and autoxt.m4"
cp ./autoxt/autoxt.m4 ./config/ || exit 1
cp ./autoxt/Makefile.xt . || exit 1

autoreconf -ifv  || exit 1

# Bootstrap the subpackages
PKGS="autoxt srts xtc xtc2 strc-core gpp c-tools concrete-syntax \
  aterm-front stratego-front asfix-tools sdf-front sdf-tools \
  stratego-regular xml-front stratego-lib "

#strc

for dir in $PKGS
do 
  echo
  echo "bootstrap: bootstrapping in $dir"
  echo
  cd $dir
  if test "$dir" != "autoxt"
  then
    cp ../Makefile.xt . 
  fi
  if test -e "../svn-revision"
  then
    cp ../svn-revision .
  fi
  autoreconf -ifv || exit 1
  cd ..
done
