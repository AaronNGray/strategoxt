module lift-dynamic-rules-old-test
imports liblib lift-dynamic-rules-old
strategies

  lift-dynamic-rules-old-test-io =
    test-suite(!"lift-dynamic-rules-old-test",
      test1;
      test2;
      test3
    )

  test1 =
    apply-test(!"test1"
	, Strategies(lift-dynamic-rule-old)
	, <downgrade-new-dr-syntax> |[
             strategies
		BindConstant(|) =
                  ?Assign(Var(X), E)
                  ; rules( ConstProp(|) : Var(X) -> E where id )
           ]|
	)

  test2 =
    apply-test(!"test2"
	, where(!["X", "E"])
	  ; SplitDynamicRule-old(!|[ assert(!~str:<id>) ]|)
	, <downgrade-new-dr-syntax> |[
             ConstProp(|) : Var(X) -> E where id
          ]|
	)

  test3 =
    apply-test(!"test3"
	, Strategies(lift-dynamic-rule-old)
	, <downgrade-new-dr-syntax> |[
              strategies
		BindConstant(|) =
                  ?fdec@FunDec(F, _, _)
                  ; rules( Inline(|) : Call(F, ES) -> E 
				      where <rename(|)> fdec => FunDec(F, XS, E) )
           ]|
	)
