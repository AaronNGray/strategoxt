Specification([Imports(["xtc-rep","scoped-finite-map"]),Signature([Constructors([OpDecl("FILE",FunType([ConstType(Var("String"))],ConstType(Var("File")))),OpDecl("DIR",FunType([ConstType(Var("String"))],ConstType(Var("File")))),OpDecl("TEMP",ConstType(Var("XtcKey"))),OpDecl("TempFiles",ConstType(Var("Table")))])]),Strategies([RDef("rename-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Op("FILE",[Var("newname")]),Seq(AM(Call(SVar("name"),[]),Var("newname")),Seq(Not(Call(SVar("stdout"),[])),BA(Call(SVar("rename-file"),[]),Op("",[Var("oldname"),Var("newname")])))))),RDef("rename-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Var("stdout"),Seq(AM(Call(SVar("name"),[]),Var("stdout")),Seq(AM(BA(Call(SVar("ReadFromFile"),[]),Var("oldname")),Var("term")),BA(Call(SVar("WriteToTextFile"),[]),Op("",[Var("stdout"),Var("term")])))))),RDef("read-from",[],Rule(Op("FILE",[Var("name")]),Var("t"),AM(BA(Call(SVar("ReadFromFile"),[]),Var("name")),Var("t")))),RDef("read-from",[],Rule(Var("stdin"),Var("t"),AM(BA(Call(SVar("ReadFromFile"),[]),Var("stdin")),Var("t")))),RDef("write-to",[],Rule(Var("t"),Op("FILE",[Var("name")]),Seq(AM(Call(SVar("xtc-new-file"),[]),Var("name")),BA(Call(SVar("WriteToTextFile"),[]),Op("",[Var("name"),Var("t")]))))),SDef("xtc-new-file",[],Seq(AM(Call(SVar("new-file"),[]),Var("f")),Where(BA(Call(SVar("assert"),[Build(Var("TempFiles"))]),Op("",[Var("f"),Op("",[])]))))),SDef("xtc-remove-temporaries",[],Where(Seq(AM(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Var("TEMP")])),Var("fs")),Call(SVar("map"),[Call(SVar("try"),[Call(SVar("remove-file"),[])])])))),SDef("xtc-temp-files",[DefaultVarDec("s")],Seq(Call(SVar("begin-scope"),[Build(Var("TempFiles"))]),Seq(Call(SVar("s"),[]),Seq(Where(Seq(AM(LChoice(BA(Call(SVar("table-get"),[]),Op("",[Var("TempFiles"),Var("Scopes")])),Build(Op("Cons",[Op("Nil",[]),Op("Nil",[])]))),Op("Cons",[Var("scope"),Var("scopes")])),BA(Call(SVar("map"),[Call(SVar("try"),[Call(SVar("remove-file"),[])])]),Var("scope")))),Call(SVar("end-scope"),[Build(Var("TempFiles"))]))))),SDef("xtc-command",[DefaultVarDec("tool")],Seq(Where(Seq(Call(SVar("tool"),[]),AM(Call(SVar("xtc-find-warning"),[]),Var("loc")))),Where(BA(Call(SVar("call"),[]),Op("",[Var("loc"),RootApp(Id)]))))),SDef("xtc-transform",[DefaultVarDec("tool")],Call(SVar("xtc-transform"),[Call(SVar("tool"),[]),Build(Op("Nil",[]))])),SDef("xtc-transform",[DefaultVarDec("tool"),DefaultVarDec("args")],LChoice(Call(SVar("xtc-transform-file"),[Call(SVar("tool"),[]),Call(SVar("args"),[])]),Call(SVar("xtc-transform-term"),[Call(SVar("tool"),[]),Call(SVar("args"),[])]))),SDef("xtc-transform-file",[DefaultVarDec("tool")],Call(SVar("xtc-transform-file"),[Call(SVar("tool"),[]),Build(Op("Nil",[]))])),RDef("xtc-transform-file",[DefaultVarDec("tool"),DefaultVarDec("args")],Rule(Op("FILE",[Var("f")]),Op("FILE",[Var("g")]),Seq(AM(BA(Call(SVar("xtc-new-file"),[]),Var("f")),Var("g")),BA(Call(SVar("xtc-command"),[Call(SVar("tool"),[])]),Op("Cons",[Str("-i"),Op("Cons",[Var("f"),Op("Cons",[Str("-o"),Op("Cons",[Var("g"),RootApp(Call(SVar("args"),[]))])])])]))))),RDef("xtc-transform-file",[DefaultVarDec("tool"),DefaultVarDec("args")],Rule(Var("stdin"),Op("FILE",[Var("g")]),Seq(AM(Call(SVar("xtc-new-file"),[]),Var("g")),BA(Call(SVar("xtc-command"),[Call(SVar("tool"),[])]),Op("Cons",[Str("-o"),Op("Cons",[Var("g"),RootApp(Call(SVar("args"),[]))])]))))),SDef("xtc-transform-term",[DefaultVarDec("tool"),DefaultVarDec("args")],Seq(Call(SVar("write-to"),[]),Seq(Call(SVar("xtc-transform-file"),[Call(SVar("tool"),[]),Call(SVar("args"),[])]),Call(SVar("read-from"),[]))))])])
