Specification([Imports(["xtc-rep","config","scoped-finite-map","options","io","exec","dir"]),Signature([Constructors([OpDecl("FILE",FunType([ConstType(Sort("String",[]))],ConstType(Sort("File",[])))),OpDecl("DIR",FunType([ConstType(Sort("String",[]))],ConstType(Sort("File",[])))),OpDecl("TEMP",ConstType(Sort("XtcKey",[]))),OpDecl("TempFiles",ConstType(Sort("Table",[])))])]),Strategies([RDef("rename-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Op("FILE",[Var("oldname")]),AM(Call(SVar("name"),[]),Var("oldname")))),RDef("rename-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Op("FILE",[Var("newname")]),Seq(AM(Call(SVar("name"),[]),Var("newname")),Seq(Not(Choice(Call(SVar("stdout"),[]),Match(Var("oldname")))),BA(Call(SVar("rename-file"),[]),Op("",[Var("oldname"),Var("newname")])))))),RDef("rename-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Var("stdout"),Seq(AM(Call(SVar("name"),[]),Var("stdout")),Seq(BA(Call(SVar("copy-file"),[]),Op("",[Var("oldname"),Var("stdout")])),BA(Call(SVar("remove-file"),[]),Var("oldname")))))),RDef("copy-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Op("FILE",[Var("oldname")]),AM(Call(SVar("name"),[]),Var("oldname")))),RDef("copy-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Op("FILE",[Var("oldname")]),Seq(AM(Call(SVar("name"),[]),Var("newname")),Seq(Not(Choice(Call(SVar("stdout"),[]),Choice(Call(SVar("stderr"),[]),Match(Var("oldname"))))),BA(Call(SVar("copy-file"),[]),Op("",[Var("oldname"),Var("newname")])))))),RDef("copy-to",[DefaultVarDec("name")],Rule(Op("FILE",[Var("oldname")]),Op("FILE",[Var("oldname")]),Seq(AM(Call(SVar("name"),[]),Var("file")),Seq(Choice(Call(SVar("stdout"),[]),Call(SVar("stderr"),[])),BA(Call(SVar("copy-file"),[]),Op("",[Var("oldname"),Var("file")])))))),RDef("read-from",[],Rule(Op("FILE",[Var("name")]),Var("t"),AM(BA(Seq(Call(SVar("file-exists"),[]),Call(SVar("ReadFromFile"),[])),Var("name")),Var("t")))),RDef("read-from",[],Rule(Var("stdin"),Var("t"),AM(BA(Call(SVar("ReadFromFile"),[]),Var("stdin")),Var("t")))),RDef("write-to",[],Rule(Var("t"),Op("FILE",[Var("name")]),Seq(AM(Call(SVar("xtc-new-file"),[]),Var("name")),BA(Call(SVar("WriteToBinaryFile"),[]),Op("",[Var("name"),Var("t")]))))),RDef("write-to-text",[],Rule(Var("t"),Op("FILE",[Var("name")]),Seq(AM(Call(SVar("xtc-new-file"),[]),Var("name")),BA(Call(SVar("WriteToTextFile"),[]),Op("",[Var("name"),Var("t")]))))),RDef("print-to",[],Rule(Var("strings"),Op("FILE",[Var("name")]),Seq(AM(Call(SVar("xtc-new-file"),[]),Var("name")),Seq(BA(Call(SVar("open-file"),[]),Op("",[Var("name"),Str("w")])),Seq(BA(Call(SVar("print"),[]),Op("",[Var("name"),Var("strings")])),BA(Call(SVar("close-file"),[]),Var("name"))))))),SDef("xtc-find-file",[],Build(Op("FILE",[RootApp(Call(SVar("xtc-find"),[]))]))),SDef("xtc-new-file",[],Seq(AM(Call(SVar("new-temp-file"),[]),Op("",[Var("f"),Var("fd")])),Seq(Where(BA(Call(SVar("assert"),[Build(Var("TempFiles"))]),Op("",[Var("f"),Op("",[])]))),Seq(BA(Call(SVar("close"),[]),Var("fd")),Build(Var("f")))))),SDef("xtc-remove-temporaries",[],Where(Seq(AM(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Var("TEMP")])),Var("fs")),Call(SVar("map"),[Call(SVar("try"),[Call(SVar("remove-file"),[])])])))),SDef("xtc-temp-files",[DefaultVarDec("s")],Seq(Call(SVar("begin-scope"),[Build(Var("TempFiles"))]),Call(SVar("restore-always"),[Call(SVar("s"),[]),Seq(Where(Seq(AM(LChoice(BA(Call(SVar("table-get"),[]),Op("",[Var("TempFiles"),Var("Scopes")])),Build(Op("Cons",[Op("Nil",[]),Op("Nil",[])]))),Op("Cons",[Var("scope"),Var("scopes")])),BA(Call(SVar("map"),[Call(SVar("try"),[Call(SVar("remove-file"),[])])]),Var("scope")))),Call(SVar("end-scope"),[Build(Var("TempFiles"))]))]))),SDef("xtc-exit",[],Seq(Match(Var("status")),Seq(Call(SVar("repeat"),[Seq(Where(Seq(AM(BA(Call(SVar("table-get"),[]),Op("",[Var("TempFiles"),Var("Scopes")])),Op("Cons",[Var("scope"),Var("scopes")])),BA(Call(SVar("map"),[Call(SVar("try"),[Call(SVar("remove-file"),[])])]),Var("scope")))),Call(SVar("end-scope"),[Build(Var("TempFiles"))]))]),Call(SVar("exit"),[])))),SDef("xtc-io",[DefaultVarDec("s")],Call(SVar("xtc-temp-files"),[Seq(LChoice(Build(Op("FILE",[App(Call(SVar("get-config"),[]),Str("-i"))])),Build(Var("stdin"))),Seq(Call(SVar("s"),[]),Call(SVar("xtc-write-output"),[])))])),SDef("xtc-io-exit",[],Seq(Call(SVar("xtc-write-output"),[]),BA(Call(SVar("xtc-exit"),[]),Int(0)))),SDef("xtc-write-output",[],Seq(Match(Op("FILE",[Wld])),Call(SVar("copy-to"),[LChoice(BA(Call(SVar("get-config"),[]),Str("-o")),Build(Op("stdout",[])))]))),SDef("xtc-write-output",[],Seq(Match(Op("stdin",[])),BA(Call(SVar("copy-file"),[]),Op("",[Op("stdin",[]),App(LChoice(Call(SVar("get-config"),[]),Build(Op("stdout",[]))),Str("-o"))])))),SDef("xtc-ensure-file",[],Match(Op("FILE",[Wld]))),SDef("xtc-ensure-file",[],Seq(Match(Op("stdin",[])),Seq(Where(AM(BA(Call(SVar("xtc-new-file"),[]),Op("",[])),Var("f"))),Seq(BA(Call(SVar("copy-file"),[]),Op("",[Op("stdin",[]),Var("f")])),Build(Op("FILE",[Var("f")])))))),SDef("xtc-output",[DefaultVarDec("s")],Call(SVar("xtc-temp-files"),[Seq(Call(SVar("s"),[]),Call(SVar("copy-to"),[LChoice(BA(Call(SVar("get-config"),[]),Str("-o")),Build(Var("stdout")))]))])),SDef("xtc-input",[DefaultVarDec("s")],Call(SVar("xtc-temp-files"),[Seq(LChoice(Build(Op("FILE",[App(Call(SVar("get-config"),[]),Str("-i"))])),Build(Var("stdin"))),Call(SVar("s"),[]))])),SDef("xtc-io-wrap",[DefaultVarDec("s")],Call(SVar("xtc-io-wrap"),[Fail,Call(SVar("s"),[])])),SDef("xtc-io-wrap",[DefaultVarDec("extra-opts"),DefaultVarDec("s")],Call(SVar("option-wrap"),[LChoice(Call(SVar("extra-opts"),[]),Call(SVar("io-options"),[])),Call(SVar("xtc-io"),[Call(SVar("s"),[])])])),SDef("xtc-io-wrap",[DefaultVarDec("extra-opts"),DefaultVarDec("deps"),DefaultVarDec("s")],Call(SVar("option-wrap"),[LChoice(Call(SVar("extra-opts"),[]),LChoice(Call(SVar("io-options"),[]),Call(SVar("check-options"),[Call(SVar("deps"),[])]))),Seq(Call(SVar("xtc-check-dependencies"),[]),Call(SVar("xtc-io"),[Call(SVar("s"),[])]))])),SDef("xtc-iowrap",[DefaultVarDec("s")],Call(SVar("xtc-io-wrap"),[Call(SVar("s"),[])])),SDef("xtc-iowrap",[DefaultVarDec("extra-opts"),DefaultVarDec("s")],Call(SVar("xtc-io-wrap"),[Call(SVar("extra-opts"),[]),Call(SVar("s"),[])])),SDef("xtc-input-wrap",[DefaultVarDec("s")],Call(SVar("xtc-input-wrap"),[Fail,Call(SVar("s"),[])])),SDef("xtc-input-wrap",[DefaultVarDec("extra-options"),DefaultVarDec("s")],Call(SVar("option-wrap"),[LChoice(Call(SVar("extra-options"),[]),Call(SVar("input-options"),[])),Call(SVar("xtc-input"),[Call(SVar("s"),[])])])),SDef("check-options",[DefaultVarDec("deps")],Call(SVar("Option"),[Match(Str("--check")),Where(BA(Call(SVar("set-config"),[]),Op("",[Str("--check"),RootApp(Call(SVar("deps"),[]))]))),Build(Str("--check        check tool dependencies"))])),SDef("xtc-check-dependencies",[],Call(SVar("if"),[BA(Call(SVar("get-config"),[]),Str("--check")),Seq(Call(SVar("filter"),[Not(Call(SVar("xtc-find-silent"),[]))]),Call(SVar("if"),[Not(Call(SVar("Nil"),[])),Seq(Call(SVar("debug"),[Build(Str("No XTC registration found for: "))]),BA(Call(SVar("exit"),[]),Int(1))),Seq(BA(Call(SVar("echo"),[]),Str("All tools available")),BA(Call(SVar("exit"),[]),Int(0)))]))])),SDef("xtc-command",[DefaultVarDec("tool")],Seq(Where(Seq(Call(SVar("tool"),[]),AM(Call(SVar("xtc-find-warning"),[]),Var("loc")))),Where(BA(Call(SVar("call"),[]),Op("",[Var("loc"),RootApp(Id)]))))),SDef("xtc-transform",[DefaultVarDec("tool")],Call(SVar("xtc-transform"),[Call(SVar("tool"),[]),Build(Op("Nil",[]))])),SDef("xtc-transform",[DefaultVarDec("tool"),DefaultVarDec("args")],GuardedLChoice(Choice(Call(SVar("FILE"),[Id]),Call(SVar("stdin"),[])),Call(SVar("xtc-transform-file"),[Call(SVar("tool"),[]),Call(SVar("args"),[])]),Call(SVar("xtc-transform-term"),[Call(SVar("tool"),[]),Call(SVar("args"),[])])))]),Strategies([SDef("xtc-transform-file",[],Match(Op("",[Var("tool"),Var("args"),Var("file")]))),SDef("xtc-transform-file",[DefaultVarDec("tool")],Call(SVar("xtc-transform-file"),[Call(SVar("tool"),[]),Build(Op("Nil",[]))])),RDef("xtc-transform-file",[DefaultVarDec("tool"),DefaultVarDec("args")],Rule(Op("FILE",[Var("f")]),Op("FILE",[Var("g")]),Seq(AM(BA(Call(SVar("xtc-new-file"),[]),Var("f")),Var("g")),BA(Seq(Call(SVar("conc"),[]),Call(SVar("xtc-command"),[Call(SVar("tool"),[])])),Op("",[RootApp(Call(SVar("args"),[])),Op("Cons",[Str("-i"),Op("Cons",[Var("f"),Op("Cons",[Str("-o"),Op("Cons",[Var("g"),Op("Nil",[])])])])])]))))),RDef("xtc-transform-file",[DefaultVarDec("tool"),DefaultVarDec("args")],Rule(Var("stdin"),Op("FILE",[Var("g")]),Seq(AM(Call(SVar("xtc-new-file"),[]),Var("g")),BA(Seq(Call(SVar("conc"),[]),Call(SVar("xtc-command"),[Call(SVar("tool"),[])])),Op("",[RootApp(Call(SVar("args"),[])),Op("Cons",[Str("-o"),Op("Cons",[Var("g"),Op("Nil",[])])])]))))),SDef("xtc-transform-term",[DefaultVarDec("tool"),DefaultVarDec("args")],Seq(Call(SVar("write-to"),[]),Seq(Call(SVar("xtc-transform-file"),[Call(SVar("tool"),[]),Call(SVar("args"),[])]),Call(SVar("read-from"),[])))),SDef("xtc-io-transform",[DefaultVarDec("s")],Seq(Call(SVar("read-from"),[]),Seq(Call(SVar("s"),[]),Call(SVar("write-to"),[])))),SDef("xtc-io-transform-text",[DefaultVarDec("s")],Seq(Call(SVar("read-from"),[]),Seq(Call(SVar("s"),[]),Call(SVar("print-to"),[])))),SDef("xtc-generate",[DefaultVarDec("tool")],Call(SVar("xtc-generate"),[Call(SVar("tool"),[]),Build(Op("Nil",[]))])),RDef("xtc-generate",[DefaultVarDec("tool"),DefaultVarDec("args")],Rule(Wld,Op("FILE",[Var("g")]),Seq(AM(BA(Call(SVar("xtc-new-file"),[]),Op("",[])),Var("g")),BA(Seq(Call(SVar("conc"),[]),Call(SVar("xtc-command"),[Call(SVar("tool"),[])])),Op("",[RootApp(Call(SVar("args"),[])),Op("Cons",[Str("-o"),Op("Cons",[Var("g"),Op("Nil",[])])])])))))]),Strategies([RDef("xtc-cat",[],Rule(Var("in-files"),Var("file"),Seq(AM(Call(SVar("xtc-new-file-name"),[]),Var("file")),Seq(AM(BA(Call(SVar("xtc-open-fd"),[]),Var("file")),Var("fdout")),Seq(BA(Call(SVar("map"),[Call(SVar("File-as-fd"),[BA(Call(SVar("fdcopy"),[]),Op("",[RootApp(Id),Var("fdout")]))])]),Var("in-files")),BA(Call(SVar("xtc-close-fd"),[]),Var("fdout"))))))),SDef("File-as-fd",[DefaultVarDec("s")],Seq(AM(Call(SVar("xtc-open-fd"),[]),Var("fd")),Call(SVar("finally"),[Call(SVar("s"),[]),Where(Call(SVar("try"),[BA(Call(SVar("xtc-close-fd"),[]),Var("fd"))]))]))),SDef("xtc-new-file-name",[],Seq(AM(Call(SVar("new-file"),[]),Var("f")),Seq(Where(BA(Call(SVar("assert"),[Build(Var("TempFiles"))]),Op("",[Var("f"),Op("",[])]))),Build(Op("FILE",[Var("f")]))))),SDef("xtc-open-fd",[],Choice(LRule(Rule(Op("FILE",[Var("s")]),App(Call(SVar("open"),[]),Var("s")),Id)),Choice(LRule(Rule(Op("stdin",[]),App(Call(SVar("STDIN_FILENO"),[]),Op("",[])),Id)),Choice(LRule(Rule(Op("stdout",[]),App(Call(SVar("STDOUT_FILENO"),[]),Op("",[])),Id)),LRule(Rule(Op("stderr",[]),App(Call(SVar("STDERR_FILENO"),[]),Op("",[])),Id)))))),SDef("xtc-close-fd",[],Call(SVar("finally"),[LChoice(Choice(Where(BA(Call(SVar("eq"),[]),Op("",[RootApp(Id),App(Call(SVar("STDIN_FILENO"),[]),Op("",[]))]))),Choice(Where(BA(Call(SVar("eq"),[]),Op("",[RootApp(Id),App(Call(SVar("STDOUT_FILENO"),[]),Op("",[]))]))),Where(BA(Call(SVar("eq"),[]),Op("",[RootApp(Id),App(Call(SVar("STDERR_FILENO"),[]),Op("",[]))]))))),Call(SVar("close"),[])),Build(Op("",[]))]))])])
