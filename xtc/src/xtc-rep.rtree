Specification([Imports(["exec","tables","config"]),Signature([Sorts([Sort("XtcKey",[])]),Constructors([OpDecl("Tool",FunType([ConstType(Var("String"))],ConstType(Var("XtcKey")))),OpDecl("Repository",ConstType(Var("XtcKey"))),OpDecl("Import",ConstType(Var("XtcKey"))),OpDecl("Imported",FunType([ConstType(Var("String"))],ConstType(Var("XtcKey")))),OpDecl("XTC",ConstType(Var("Table")))])]),Strategies([SDef("xtc-location",[],LChoice(BA(Call(SVar("get-config"),[]),Str("-r")),LChoice(BA(Call(SVar("getenv"),[]),Str("XTC_REPOSITORY")),Prim("XTC_REPOSITORY",[])))),SDef("xtc-read",[],Seq(Match(Var("rep")),Seq(Not(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Op("Imported",[Var("rep")])]))),Seq(Where(BA(Call(SVar("table-put"),[]),Op("",[Var("XTC"),Var("Repository"),Var("rep")]))),Seq(Call(SVar("if-verbose4"),[Call(SVar("debug"),[Build(Str("Reading repository: "))])]),Seq(LChoice(Seq(Call(SVar("file-exists"),[]),Call(SVar("ReadFromFile"),[])),Build(Op("Nil",[]))),Seq(BA(Call(SVar("table-putlist"),[]),Op("",[Var("XTC"),RootApp(Id)])),BA(Call(SVar("table-put"),[]),Op("",[Var("XTC"),Op("Imported",[Var("rep")]),Op("",[])]))))))))),SDef("xtc-import",[],Call(SVar("try"),[Seq(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Var("Import")])),Call(SVar("map"),[Call(SVar("try"),[Call(SVar("xtc-read"),[])])]))])),SDef("xtc-load",[],Seq(Call(SVar("if-verbose5"),[Call(SVar("debug"),[Build(Str("xtc-load: "))])]),Seq(Where(LChoice(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Var("Repository")])),Seq(Call(SVar("xtc-location"),[]),Seq(Call(SVar("xtc-read"),[]),Call(SVar("xtc-import"),[]))))),Call(SVar("if-verbose5"),[Call(SVar("debug"),[Build(Str("xtc-loaded: "))])])))),SDef("xtc-store",[],Seq(Call(SVar("if-verbose1"),[Call(SVar("say"),[Build(Str("  Saving repository "))])]),BA(Call(SVar("WriteToTextFile"),[]),Op("",[App(Call(SVar("get-config"),[]),Str("-r")),App(Call(SVar("table-getlist"),[]),Var("XTC"))]))))])])
