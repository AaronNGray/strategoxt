Specification([Imports(["exec","tables","config","file"]),Signature([Sorts([Sort("XtcKey",[])]),Constructors([OpDecl("Tool",FunType([ConstType(Var("String"))],ConstType(Var("XtcKey")))),OpDecl("Repository",ConstType(Var("XtcKey"))),OpDecl("Import",ConstType(Var("XtcKey"))),OpDecl("Imported",FunType([ConstType(Var("String"))],ConstType(Var("XtcKey")))),OpDecl("XTC",ConstType(Var("Table")))])]),Strategies([SDef("xtc-location",[],LChoice(BA(Call(SVar("get-config"),[]),Str("-r")),LChoice(BA(Call(SVar("getenv"),[]),Str("XTC_REPOSITORY")),Prim("XTC_REPOSITORY",[])))),SDef("xtc-read",[],Seq(Match(Var("rep")),Seq(Call(SVar("if-verbose5"),[Call(SVar("debug"),[Build(Str("Reading? "))])]),Seq(Not(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Op("Imported",[Var("rep")])]))),Seq(Where(BA(Call(SVar("table-put"),[]),Op("",[Var("XTC"),Var("Repository"),Op("Cons",[Var("rep"),Op("Nil",[])])]))),Seq(Call(SVar("if-verbose4"),[Call(SVar("debug"),[Build(Str("Reading repository: "))])]),Seq(Call(SVar("read-repository-file"),[]),Seq(Call(SVar("if-verbose6"),[Call(SVar("say"),[Build(Str("Repository read: "))])]),Seq(BA(Call(SVar("table-putlist"),[Call(SVar("table-append"),[])]),Op("",[Var("XTC"),RootApp(Id)])),Seq(Call(SVar("if-verbose6"),[Call(SVar("say"),[Build(Str("Repository stored in table: "))])]),Seq(BA(Call(SVar("table-put"),[]),Op("",[Var("XTC"),Op("Imported",[Var("rep")]),Op("Nil",[])])),Call(SVar("if-verbose4"),[Call(SVar("say"),[Build(Str("Repository read: "))])])))))))))))),SDef("read-repository-file",[],GuardedLChoice(Call(SVar("can-read-file"),[]),Call(SVar("ReadFromFile"),[]),Seq(LChoice(Seq(Not(Call(SVar("file-exists"),[])),Call(SVar("debug"),[Build(Str("** WARNING: Repository doesn't exist: "))])),Call(SVar("debug"),[Build(Str("** WARNING: No read permission for repository: "))])),Build(Op("Nil",[]))))),SDef("xtc-import",[],Where(Call(SVar("repeat"),[Seq(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Var("Import")])),Seq(Call(SVar("filter"),[Call(SVar("xtc-read"),[])]),Not(Call(SVar("Nil"),[]))))]))),SDef("xtc-load",[],Seq(Call(SVar("if-verbose5"),[Call(SVar("debug"),[Build(Str("xtc-load: "))])]),Seq(Where(LChoice(BA(Call(SVar("table-get"),[]),Op("",[Var("XTC"),Var("Repository")])),Seq(Call(SVar("xtc-location"),[]),Seq(Call(SVar("xtc-read"),[]),Call(SVar("xtc-import"),[]))))),Call(SVar("if-verbose5"),[Call(SVar("debug"),[Build(Str("xtc-loaded: "))])])))),SDef("xtc-store",[],Seq(Call(SVar("if-verbose1"),[Call(SVar("say"),[Build(Str("  Saving repository "))])]),Seq(BA(Call(SVar("get-config"),[]),Str("-r")),GuardedLChoice(Call(SVar("can-write-file"),[]),BA(Call(SVar("WriteToTextFile"),[]),Op("",[RootApp(Id),App(Call(SVar("table-getlist"),[]),Var("XTC"))])),Seq(Call(SVar("debug"),[Build(Str("** WARNING: No write permission for repository: "))]),Fail)))))])])
